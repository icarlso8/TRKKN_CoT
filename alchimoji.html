<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alchimoji</title>
  <!-- <link rel="icon" href="https://cdn.jsdelivr.net/gh/icarlso8/TRKKN_CoT/assets/logos/logo_claro_v1.png"> -->
  <link rel="icon" href="assets/TRKKN_icon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Mulish&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  body {
    font-family: 'Mulish', sans-serif;
    background-color: #111;
    color: #fff;
    padding: 20px;
  }

  form {
    max-width: 1000px;
    margin: 0 auto;
  }

  .form-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 16px;
    margin: 20px 0;
  }

  .form-section strong {
    width: 140px;
  }

  .form-section label {
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  input[type="text"] {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
    max-width: 400px;
    font-size: 14px;
    font-family: 'Mulish', sans-serif;
  }

  input[type="checkbox"] {
    transform: scale(1.2);
  }

  button {
    font-family: 'Mulish', sans-serif;
    padding: 10px 16px;
    background-color: #00C6AE;
    color: #000;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    margin-right: 10px;
  }

  button:hover {
    background-color: #00b39b;
  }

  .preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 30px;
  }

  .preview {
    position: relative;
    border: 1px solid #444;
    background: #222;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  img {
    max-width: 100%;
    height: auto;
  }
</style>

</head>
<body>
  <h1><img src="Alchimoji_Logo.png" alt="Alchimoji Logo""></h1>

<form id="assetForm">
  <div class="form-section">
    <strong>ğŸ¯ Audiencia:</strong>
    <label><input type="checkbox" name="audiencia" value="gamers"> ğŸ® Gamers</label>
    <label><input type="checkbox" name="audiencia" value="streaming"> ğŸ“º Streaming</label>
    <label><input type="checkbox" name="audiencia" value="melomaniac"> ğŸµ MelÃ³manos</label>
  </div>

  <div class="form-section">
    <strong>ğŸ•’ Momento del dÃ­a:</strong>
    <label><input type="checkbox" name="momento" value="dia"> ğŸŒ DÃ­a</label>
    <label><input type="checkbox" name="momento" value="noche"> ğŸŒ™ Noche</label>
  </div>

  <div class="form-section">
    <strong>ğŸ“ Texto (Copy):</strong>
    <input type="text" name="copy" placeholder="Escribe tu copy aquÃ­..." style="flex: 1; min-width: 250px;">
  </div>

  <div class="form-section">
    <strong>ğŸ“ TamaÃ±os:</strong>
    <label><input type="checkbox" name="size" value="300x600"> 300x600</label>
    <label><input type="checkbox" name="size" value="728x90"> 728x90</label>
    <label><input type="checkbox" name="size" value="300x250"> 300x250</label>
    <label><input type="checkbox" name="size" value="320x50"> 320x50</label>
    <label><input type="checkbox" name="size" value="160x600"> 160x600</label>
  </div>

  <button type="submit">ğŸ¨ Generar creatividades</button>
  </form>

  <button id="downloadAllBtn">ğŸ“¦ Descargar todas</button>
    
  </div>

  <div class="preview-container" id="previewContainer"></div>

  <script>
    const form = document.getElementById('assetForm');
    const previewContainer = document.getElementById('previewContainer');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const baseURL = "https://cdn.jsdelivr.net/gh/icarlso8/TRKKN_CoT/assets";
    let generatedImages = [];

    function downloadURI(uri, name) {
      const link = document.createElement("a");
      link.download = name;
      link.href = uri;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      previewContainer.innerHTML = '';
      generatedImages = [];

      const audiencias = [...form.querySelectorAll('input[name="audiencia"]:checked')].map(el => el.value);
      const momentos = [...form.querySelectorAll('input[name="momento"]:checked')].map(el => el.value);
      const sizes = [...form.querySelectorAll('input[name="size"]:checked')].map(el => el.value);
      const copy = form.copy.value || "Tu mensaje aquÃ­";

      audiencias.forEach(aud => {
        momentos.forEach(mom => {
          sizes.forEach(size => {
            const fondoPath = `${baseURL}/${aud}/${mom}/${aud}_${mom}_01.png`;
            const logoPath = `${baseURL}/logos/logo_claro_v1.png`;

            const canvas = document.createElement('canvas');
            const [w, h] = size.split('x').map(Number);
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');

            const fondoImg = new Image();
            const logoImg = new Image();
            let imagesLoaded = 0;

            fondoImg.crossOrigin = "anonymous";
            logoImg.crossOrigin = "anonymous";
            fondoImg.src = fondoPath;
            logoImg.src = logoPath;

            fondoImg.onload = logoImg.onload = () => {
              imagesLoaded++;
              if (imagesLoaded === 2) {
                ctx.drawImage(fondoImg, 0, 0, w, h);
                ctx.drawImage(logoImg, 10, 10, 40, 40);
                ctx.fillStyle = "white";
                ctx.font = "bold 14px Mulish";
                ctx.fillText(copy, 10, h - 20);

                const dataURL = canvas.toDataURL("image/png");
                const div = document.createElement('div');
                div.className = 'preview';
                div.style.width = w + 'px';
                div.style.height = h + 'px';
                div.innerHTML = `
                  <img src="${dataURL}" alt="Creatividad" />
                  <button onclick="downloadURI('${dataURL}', 'alchimoji_${aud}_${mom}_${size}.png')">â¬‡ï¸ Descargar</button>
                `;
                previewContainer.appendChild(div);
                generatedImages.push({ name: `alchimoji_${aud}_${mom}_${size}.png`, data: dataURL });
              }
            };
          });
        });
      });
    });

    downloadAllBtn.addEventListener('click', async () => {
      if (!generatedImages.length) {
        alert("Primero genera creatividades.");
        return;
      }
      const zip = new JSZip();
      generatedImages.forEach(img => {
        zip.file(img.name, img.data.split(',')[1], { base64: true });
      });
      const blob = await zip.generateAsync({ type: "blob" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "alchimoji_creatividades.zip";
      link.click();
    });
  </script>
</body>
</html>
