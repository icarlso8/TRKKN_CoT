<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alchimoji</title>
  <!-- <link rel="icon" href="https://cdn.jsdelivr.net/gh/icarlso8/TRKKN_CoT/assets/logos/logo_claro_v1.png"> -->
  <link rel="icon" href="assets/TRKKN_icon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Mulish&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <style>
  body {
    font-family: 'Mulish', sans-serif;
    background-color: #111;
    color: #fff;
    padding: 30px;
  }

  form {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    max-width: 1080px;
    margin: 0 auto;
    gap: 20px;
  }

  .form-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 12px;
    width: 100%;
  }

  .form-section strong {
    min-width: 160px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .form-section label {
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  input[type="text"] {
    padding: 6px 8px;
    border-radius: 6px;
    border: none;
    font-family: 'Mulish', sans-serif;
    max-width: 260px;
  }

  input[type="color"],
  select {
    padding: 4px;
    border-radius: 6px;
    font-family: 'Mulish', sans-serif;
  }

  input[type="checkbox"] {
    transform: scale(1.2);
  }

  button {
    font-family: 'Mulish', sans-serif;
    padding: 10px 16px;
    background-color: #00C6AE;
    color: #000;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    margin-right: 10px;
  }

  button:hover {
    background-color: #00b39b;
  }
  </style>

</head>
<body>
  <h1><img src="Alchimoji_Logo.png" alt="Alchimoji Logo""></h1>

  <form id="alchimoji-form" style="text-align: left;">
  <!-- Logo -->
  <img src="assets/Alchimoji_Logo.png" alt="Alchimoji Logo" style="height: 60px; margin-bottom: 10px;" />

  <!-- Audiencias -->
  <div class="form-section">
    <strong>🎯 Audiencias:</strong>
    <label><input type="checkbox" name="audiencia" value="gamers"> 🎮 Gamers</label>
    <label><input type="checkbox" name="audiencia" value="streaming"> 📺 Streaming</label>
    <label><input type="checkbox" name="audiencia" value="melomaniac"> 🎵 Melómanos</label>
  </div>

  <!-- Momento del día -->
  <div class="form-section">
    <strong>🕒 Momento del día:</strong>
    <label><input type="checkbox" name="momento" value="dia"> 🌞 Día</label>
    <label><input type="checkbox" name="momento" value="noche"> 🌙 Noche</label>
  </div>

  <!-- Copies -->
  <div class="form-section" style="flex-direction: column; align-items: flex-start;">
    <strong>📝 Copies:</strong>

    <label style="margin-left: 16px; width: 100%;">
      <input type="checkbox" name="copy1">
      Texto 1:
      <input type="text" maxlength="60" name="copyText1" placeholder="Texto 1..." style="margin-left: 8px; width: 60%;">
      <input type="color" name="copyColor1" value="#ffffff" title="Color del texto">
    </label>

    <label style="margin-left: 16px; width: 100%;">
      <input type="checkbox" name="copy2">
      Texto 2:
      <input type="text" maxlength="60" name="copyText2" placeholder="Texto 2..." style="margin-left: 8px; width: 60%;">
      <input type="color" name="copyColor2" value="#ffffff" title="Color del texto">
    </label>

    <label style="margin-left: 16px; width: 100%;">
      <input type="checkbox" name="copy3">
      Texto 3:
      <input type="text" maxlength="60" name="copyText3" placeholder="Texto 3..." style="margin-left: 8px; width: 60%;">
      <input type="color" name="copyColor3" value="#ffffff" title="Color del texto">
    </label>
  </div>

  <!-- Íconos -->
  <div class="form-section" style="flex-direction: column; align-items: flex-start;">
    <strong>🧩 Íconos:</strong>

    <label style="margin-left: 16px;">
      <input type="checkbox" name="icon1">
      Icono 1:
      <select name="iconSelect1" style="margin-left: 8px;">
        <option value="icon1.png">icon1.png</option>
        <option value="icon2.png">icon2.png</option>
      </select>
    </label>

    <label style="margin-left: 16px;">
      <input type="checkbox" name="icon2">
      Icono 2:
      <select name="iconSelect2" style="margin-left: 8px;">
        <option value="icon1.png">icon1.png</option>
        <option value="icon2.png">icon2.png</option>
      </select>
    </label>

    <label style="margin-left: 16px;">
      <input type="checkbox" name="icon3">
      Icono 3:
      <select name="iconSelect3" style="margin-left: 8px;">
        <option value="icon1.png">icon1.png</option>
        <option value="icon2.png">icon2.png</option>
      </select>
    </label>
  </div>

  <!-- Tamaños -->
  <div class="form-section">
    <strong>📐 Tamaños:</strong>
    <label><input type="checkbox" name="size" value="300x600"> 300x600</label>
    <label><input type="checkbox" name="size" value="728x90"> 728x90</label>
    <label><input type="checkbox" name="size" value="300x250"> 300x250</label>
    <label><input type="checkbox" name="size" value="320x50"> 320x50</label>
    <label><input type="checkbox" name="size" value="160x600"> 160x600</label>
  </div>

  <!-- Botones -->
  <div class="form-section">
    <button type="button" onclick="generateCreatives()">Generar creatividades</button>
    <button type="button" onclick="downloadAll()">Descargar todas</button>
  </div>
  </form>



  <div class="preview-container" id="previewContainer"></div>

  <script>
    const form = document.getElementById('assetForm');
    const previewContainer = document.getElementById('previewContainer');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const baseURL = "https://cdn.jsdelivr.net/gh/icarlso8/TRKKN_CoT/assets";
    let generatedImages = [];

    function downloadURI(uri, name) {
      const link = document.createElement("a");
      link.download = name;
      link.href = uri;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      previewContainer.innerHTML = '';
      generatedImages = [];

      const audiencias = [...form.querySelectorAll('input[name="audiencia"]:checked')].map(el => el.value);
      const momentos = [...form.querySelectorAll('input[name="momento"]:checked')].map(el => el.value);
      const sizes = [...form.querySelectorAll('input[name="size"]:checked')].map(el => el.value);
      const copy = form.copy.value || "Tu mensaje aquí";

      audiencias.forEach(aud => {
        momentos.forEach(mom => {
          sizes.forEach(size => {
            const fondoPath = `${baseURL}/${aud}/${mom}/${aud}_${mom}_01.png`;
            const logoPath = `${baseURL}/logos/logo_claro_v1.png`;

            const canvas = document.createElement('canvas');
            const [w, h] = size.split('x').map(Number);
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');

            const fondoImg = new Image();
            const logoImg = new Image();
            let imagesLoaded = 0;

            fondoImg.crossOrigin = "anonymous";
            logoImg.crossOrigin = "anonymous";
            fondoImg.src = fondoPath;
            logoImg.src = logoPath;

            fondoImg.onload = logoImg.onload = () => {
              imagesLoaded++;
              if (imagesLoaded === 2) {
                ctx.drawImage(fondoImg, 0, 0, w, h);
                ctx.drawImage(logoImg, 10, 10, 40, 40);
                ctx.fillStyle = "white";
                ctx.font = "bold 14px Mulish";
                ctx.fillText(copy, 10, h - 20);

                const dataURL = canvas.toDataURL("image/png");
                const div = document.createElement('div');
                div.className = 'preview';
                div.style.width = w + 'px';
                div.style.height = h + 'px';
                div.innerHTML = `
                  <img src="${dataURL}" alt="Creatividad" />
                  <button onclick="downloadURI('${dataURL}', 'alchimoji_${aud}_${mom}_${size}.png')">⬇️ Descargar</button>
                `;
                previewContainer.appendChild(div);
                generatedImages.push({ name: `alchimoji_${aud}_${mom}_${size}.png`, data: dataURL });
              }
            };
          });
        });
      });
    });

    downloadAllBtn.addEventListener('click', async () => {
      if (!generatedImages.length) {
        alert("Primero genera creatividades.");
        return;
      }
      const zip = new JSZip();
      generatedImages.forEach(img => {
        zip.file(img.name, img.data.split(',')[1], { base64: true });
      });
      const blob = await zip.generateAsync({ type: "blob" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "alchimoji_creatividades.zip";
      link.click();
    });
  </script>
</body>
</html>
